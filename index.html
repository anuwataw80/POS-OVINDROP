                    <td><button class="btn-remove" data-id="${id}">ลบ</button></td>
                `;
                tbody.appendChild(actionTr);
            }

            // แสดงผลรวม
            document.getElementById("subtotalDisplay").textContent = subtotal.toFixed(2);

            // ค่าธรรมเนียม (ถ้ามี)
            let feePercent = channels[activeChannel] ? channels[activeChannel].fee : 0;
            let feeAmount = subtotal * (feePercent / 100);

            if (feePercent > 0) {
                document.getElementById("feeRow").style.display = "block";
                document.getElementById("feeDisplay").textContent = feeAmount.toFixed(2);
            } else {
                document.getElementById("feeRow").style.display = "none";
            }

            // ยอดสุทธิ
            let finalTotal = subtotal - feeAmount;
            document.getElementById("finalTotalDisplay").textContent = finalTotal.toFixed(2);

            // event ปุ่ม + - ลบ
            document.querySelectorAll(".btn-plus").forEach(btn =>
                btn.addEventListener("click", () => changeQty(btn.dataset.id, 1))
            );
            document.querySelectorAll(".btn-minus").forEach(btn =>
                btn.addEventListener("click", () => changeQty(btn.dataset.id, -1))
            );
            document.querySelectorAll(".btn-remove").forEach(btn =>
                btn.addEventListener("click", () => removeItem(btn.dataset.id))
            );
        }

        // ✅ ตัวอย่างการกดปุ่มยืนยัน (เก็บข้อมูลลง Google Sheet)
        document.getElementById("confirmBtn").addEventListener("click", async () => {
            if (Object.keys(cart).length === 0) {
                alert("กรุณาเลือกสินค้าอย่างน้อย 1 รายการ");
                return;
            }
            try {
                const payload = {
                    action: "saveOrder",
                    channel: activeChannel,
                    cart: cart,
                    timestamp: new Date().toISOString()
                };
                const res = await fetch(appsScriptUrl, {
                    method: "POST",
                    body: JSON.stringify(payload)
                });
                const result = await res.json();
                if (result.status === "success") {
                    alert("บันทึกออเดอร์สำเร็จ");
                    cart = {};
                    renderCart();
                } else {
                    alert("บันทึกไม่สำเร็จ");
                }
            } catch (err) {
                console.error("Error saving order:", err);
                alert("เกิดข้อผิดพลาดในการเชื่อมต่อ");
            }
        });
    </script>
</body>
</html>
